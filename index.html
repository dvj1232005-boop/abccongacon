<!--
================================================================================
AN QUY CH·∫æ ‚Äì SHIFT REGISTER SYSTEM
FINAL RELEASE ‚Äì LEVEL 3 (UX POLISH MAX)
Author: ƒê√†o ƒêƒÉng T√πng
Lines: ~1120
================================================================================
-->
<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>An Quy Ch·∫ø ‚Äì ƒêƒÉng k√Ω ca l√†m</title>
<meta name="theme-color" content="#0b3d2e">

<style>

/* ============================================================================
   SECTION 1 ‚Äì RESET & BASE
============================================================================ */
*,
*::before,
*::after{
  box-sizing:border-box;
  -webkit-tap-highlight-color:transparent;
}

html,body{
  margin:0;
  padding:0;
}

body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Inter,Roboto;
  background:linear-gradient(180deg,#020617,#0f172a);
  color:var(--text);
  min-height:100vh;
  transition:background .4s,color .4s;
}

/* ============================================================================
   SECTION 2 ‚Äì THEME VARIABLES
============================================================================ */
:root{
  --bg:#020617;
  --bg-soft:#020617;
  --card:#ffffff;
  --card-soft:#f8fafc;
  --text:#0f172a;
  --muted:#64748b;

  --primary:#16a34a;
  --primary-soft:#dcfce7;

  --warn:#f59e0b;
  --warn-soft:#fef3c7;

  --danger:#dc2626;
  --danger-soft:#fee2e2;

  --chip:#f1f5f9;
  --border:#e5e7eb;

  --radius-xl:26px;
  --radius-lg:20px;
  --radius-md:14px;
  --radius-sm:10px;

  --shadow-soft:0 10px 25px rgba(0,0,0,.06);
  --shadow-hard:0 30px 60px rgba(0,0,0,.25);

  --transition-fast:.15s ease;
  --transition:.25s ease;
  --transition-slow:.4s ease;
}

/* DARK THEME */
[data-theme="dark"]{
  --bg:#020617;
  --card:#0f172a;
  --card-soft:#020617;
  --text:#e5e7eb;
  --muted:#94a3b8;
  --chip:#020617;
  --border:#1e293b;
}

/* ============================================================================
   SECTION 3 ‚Äì LAYOUT
============================================================================ */
.app{
  max-width:430px;
  margin:auto;
  padding:18px 14px 40px;
}

.hidden{display:none}

/* ============================================================================
   SECTION 4 ‚Äì HEADER
============================================================================ */
.header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  color:white;
  margin-bottom:16px;
}

.header-title h1{
  margin:0;
  font-size:22px;
  font-weight:700;
}

.header-title p{
  margin:4px 0 0;
  font-size:13px;
  opacity:.8;
}

.theme-toggle{
  font-size:20px;
  cursor:pointer;
  user-select:none;
}

/* ============================================================================
   SECTION 5 ‚Äì CARD
============================================================================ */
.card{
  background:var(--card);
  border-radius:var(--radius-xl);
  padding:20px;
  box-shadow:var(--shadow-hard);
  margin-bottom:16px;
  animation:cardFade .35s ease;
  transition:background .4s;
}

@keyframes cardFade{
  from{opacity:0;transform:translateY(12px)}
  to{opacity:1;transform:none}
}

.card h2{
  margin:0;
  font-size:20px;
}

.sub{
  margin-top:6px;
  font-size:13px;
  color:var(--muted);
}

/* ============================================================================
   SECTION 6 ‚Äì INPUT & BUTTON
============================================================================ */
input{
  width:100%;
  height:52px;
  font-size:16px;
  padding:0 16px;
  margin-top:12px;
  border-radius:var(--radius-md);
  border:1px solid var(--border);
  background:transparent;
  color:var(--text);
  transition:var(--transition);
}

input:focus{
  outline:none;
  border-color:var(--primary);
}

button{
  width:100%;
  height:52px;
  margin-top:14px;
  border:none;
  border-radius:18px;
  font-size:16px;
  font-weight:600;
  cursor:pointer;
  transition:var(--transition-fast);
}

button:active{
  transform:scale(.96);
}

.btn-primary{
  background:linear-gradient(135deg,var(--primary),#22c55e);
  color:white;
}

.btn-secondary{
  background:#e5e7eb;
  color:#111;
}

.btn-danger{
  background:var(--danger-soft);
  color:var(--danger);
}

/* ============================================================================
   SECTION 7 ‚Äì DAY & CHIP SELECT
============================================================================ */
.day{
  margin-top:18px;
  font-size:13px;
  font-weight:700;
  color:var(--muted);
  text-transform:uppercase;
}

.chips{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin-top:8px;
}

.chip{
  padding:8px 14px;
  border-radius:999px;
  background:var(--chip);
  border:1px solid var(--border);
  font-size:14px;
  cursor:pointer;
  transition:var(--transition);
}

.chip:hover{
  transform:translateY(-1px);
}

.chip.active{
  background:var(--primary);
  border-color:var(--primary);
  color:white;
  transform:scale(1.06);
}

/* ============================================================================
   SECTION 8 ‚Äì COUNTDOWN
============================================================================ */
.countdown{
  margin-top:10px;
  font-size:14px;
  font-weight:600;
}

.progress{
  height:6px;
  border-radius:999px;
  background:#e5e7eb;
  overflow:hidden;
  margin-top:6px;
}

.progress span{
  display:block;
  height:100%;
  width:0%;
  background:var(--primary);
  transition:width 1s linear, background .3s;
}

/* ============================================================================
   SECTION 9 ‚Äì TOAST
============================================================================ */
.toast{
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%) translateY(20px);
  background:#0f172a;
  color:white;
  padding:12px 18px;
  border-radius:999px;
  font-size:14px;
  opacity:0;
  pointer-events:none;
  transition:var(--transition-slow);
}

.toast.show{
  opacity:1;
  transform:translateX(-50%) translateY(0);
}

/* ============================================================================
   SECTION 10 ‚Äì MANAGER SUMMARY
============================================================================ */
.shiftBox{
  background:var(--card-soft);
  border-radius:var(--radius-md);
  padding:12px;
  margin-top:10px;
}

.badge{
  display:inline-block;
  padding:6px 10px;
  border-radius:999px;
  background:#14532d;
  color:white;
  font-size:13px;
  margin:4px 4px 0 0;
}

/* ============================================================================
   SECTION 11 ‚Äì FOOTER
============================================================================ */
footer{
  text-align:center;
  font-size:12px;
  color:#94a3b8;
  margin-top:20px;
}

</style>
</head>

<body data-theme="dark">

<div class="app">

  <!-- HEADER -->
  <div class="header">
    <div class="header-title">
      <h1>An Quy Ch·∫ø</h1>
      <p>H·ªá th·ªëng ƒëƒÉng k√Ω ca l√†m n·ªôi b·ªô</p>
    </div>
    <div class="theme-toggle" onclick="toggleTheme()">üåô</div>
  </div>

  <!-- EMPLOYEE -->
  <div class="card" id="employeeBox">
    <h2>ƒêƒÉng k√Ω ca l√†m</h2>
    <div class="sub" id="lockStatus"></div>

    <div class="countdown" id="countdown"></div>
    <div class="progress"><span id="progressBar"></span></div>

    <input id="name" placeholder="Nh·∫≠p t√™n nh√¢n vi√™n">
    <div id="form"></div>

    <button class="btn-primary" onclick="submitShift()">X√°c nh·∫≠n ƒëƒÉng k√Ω</button>
    <button class="btn-secondary" onclick="showManager()">Qu·∫£n l√Ω</button>
  </div>

  <!-- MANAGER -->
  <div class="card hidden" id="managerBox">
    <h2>Qu·∫£n l√Ω ca l√†m</h2>
    <input id="pin" type="password" placeholder="Nh·∫≠p m√£ PIN">
    <button class="btn-primary" onclick="loginManager()">ƒêƒÉng nh·∫≠p</button>
    <div id="summary"></div>
    <button class="btn-secondary" onclick="logoutManager()">ƒêƒÉng xu·∫•t</button>
    <button class="btn-danger" onclick="clearAll()">X√≥a to√†n b·ªô</button>
  </div>

  <footer>¬© 2025 An Quy Ch·∫ø ‚Ä¢ ƒê√†o ƒêƒÉng T√πng</footer>
</div>

<div class="toast" id="toast"></div>

<script>
/* ============================================================================
   SCRIPT ‚Äì FINAL UX VERSION
============================================================================ */

/* THEME */
function toggleTheme(){
  const b=document.body;
  const next=b.dataset.theme==="dark"?"light":"dark";
  b.dataset.theme=next;
  localStorage.setItem("theme",next);
  document.querySelector(".theme-toggle").textContent=
    next==="dark"?"üåô":"‚òÄÔ∏è";
}
(()=>{
  const t=localStorage.getItem("theme")||"dark";
  document.body.dataset.theme=t;
  document.querySelector(".theme-toggle").textContent=
    t==="dark"?"üåô":"‚òÄÔ∏è";
})();

/* CONFIG */
const DAYS=["T2","T3","T4","T5","T6","T7","CN"];
const SHIFTS=["C1","C2","C3","F1","F2","2C (C1+C2)","2C (C2+C3)"];
const ADMIN_PIN="2005";

/* LOCK TIME */
function getLockTime(){
  const now=new Date();
  const lock=new Date(now);
  const d=lock.getDay();
  const diff=(6-d+7)%7;
  lock.setDate(lock.getDate()+diff);
  lock.setHours(20,0,0,0);
  if(now>lock) lock.setDate(lock.getDate()+7);
  return lock;
}
let lockTime=getLockTime();

function isLocked(){
  const n=new Date();
  return n>=lockTime || n.getDay()===0;
}

/* COUNTDOWN */
const cd=document.getElementById("countdown");
const bar=document.getElementById("progressBar");
const status=document.getElementById("lockStatus");

function updateCountdown(){
  const now=new Date();
  if(isLocked()){
    cd.textContent="‚õî ƒê√£ kh√≥a ƒëƒÉng k√Ω";
    status.textContent="M·ªü l·∫°i v√†o Th·ª© 2";
    bar.style.width="100%";
    bar.style.background="var(--danger)";
    return;
  }

  const diff=lockTime-now;
  const total=7*24*3600000;
  const percent=100-(diff/total*100);

  const h=Math.floor(diff/3600000);
  const m=Math.floor(diff%3600000/60000);
  const s=Math.floor(diff%60000/1000);

  cd.textContent=`‚è≥ C√≤n ${h}h ${m}m ${s}s s·∫Ω kh√≥a ƒëƒÉng k√Ω`;
  status.textContent="ƒêang m·ªü ƒëƒÉng k√Ω";

  bar.style.width=percent+"%";
  bar.style.background=h<1?"var(--warn)":"var(--primary)";
}
setInterval(updateCountdown,1000);
updateCountdown();

/* FORM CHIP */
const form=document.getElementById("form");
const selected={};

DAYS.forEach(d=>{
  const wrap=document.createElement("div");
  wrap.innerHTML=`<div class="day">${d}</div><div class="chips"></div>`;
  const chips=wrap.querySelector(".chips");

  SHIFTS.forEach(s=>{
    const chip=document.createElement("div");
    chip.className="chip";
    chip.textContent=s;
    chip.onclick=()=>{
      chips.querySelectorAll(".chip").forEach(c=>c.classList.remove("active"));
      chip.classList.add("active");
      selected[d]=s;
    };
    chips.appendChild(chip);
  });

  form.appendChild(wrap);
});

/* TOAST */
function toast(msg){
  const t=document.getElementById("toast");
  t.textContent=msg;
  t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"),2200);
}

/* SUBMIT */
function submitShift(){
  if(isLocked()) return toast("‚õî ƒê√£ kh√≥a ƒëƒÉng k√Ω");
  const name=document.getElementById("name").value.trim();
  if(!name) return toast("Vui l√≤ng nh·∫≠p t√™n");
  if(!Object.keys(selected).length) return toast("Ch∆∞a ch·ªçn ca");

  const data=JSON.parse(localStorage.getItem("shifts")||"[]");
  data.push({name,shifts:selected,time:Date.now()});
  localStorage.setItem("shifts",JSON.stringify(data));

  toast("‚úÖ ƒêƒÉng k√Ω th√†nh c√¥ng");
}

/* MANAGER */
function showManager(){
  document.getElementById("managerBox").classList.remove("hidden");
}
function loginManager(){
  if(document.getElementById("pin").value!==ADMIN_PIN)
    return toast("Sai m√£ PIN");
  document.getElementById("employeeBox").classList.add("hidden");
  renderSummary();
}
function logoutManager(){
  document.getElementById("employeeBox").classList.remove("hidden");
  document.getElementById("managerBox").classList.add("hidden");
}

/* SUMMARY */
function renderSummary(){
  const data=JSON.parse(localStorage.getItem("shifts")||"[]");
  const sum={};

  data.forEach(e=>{
    Object.entries(e.shifts).forEach(([d,s])=>{
      sum[d]??={};
      sum[d][s]??=[];
      sum[d][s].push(e.name);
    });
  });

  const box=document.getElementById("summary");
  box.innerHTML="";
  DAYS.forEach(d=>{
    if(!sum[d]) return;
    box.innerHTML+=`<div class="day">${d}</div>`;
    SHIFTS.forEach(s=>{
      if(!sum[d][s]) return;
      box.innerHTML+=`
        <div class="shiftBox">
          <b>${s} (${sum[d][s].length})</b><br>
          ${sum[d][s].map(n=>`<span class="badge">${n}</span>`).join("")}
        </div>`;
    });
  });
}

/* CLEAR */
function clearAll(){
  if(confirm("X√≥a to√†n b·ªô d·ªØ li·ªáu?")){
    localStorage.removeItem("shifts");
    location.reload();
  }
}
</script>

</body>
</html>


