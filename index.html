<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>An Quy Chế – Đăng ký ca làm</title>
<meta name="theme-color" content="#0b3d2e">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
  background:linear-gradient(180deg,#7f1d1d,#064e3b);
  min-height:100vh;
}
.hidden{display:none}

.container{max-width:420px;margin:auto;padding:20px}
.card{
  background:white;
  border-radius:22px;
  padding:20px;
  box-shadow:0 25px 50px rgba(0,0,0,.25);
}
h2{margin:0 0 6px}
.sub{font-size:13px;color:#555}

input,select{
  width:100%;
  height:48px;
  font-size:16px;
  padding:0 14px;
  margin:10px 0;
  border-radius:14px;
  border:1px solid #ccc;
}
button{
  width:100%;
  height:48px;
  border:none;
  border-radius:16px;
  background:#b91c1c;
  color:white;
  font-weight:600;
  margin-top:12px;
}
.secondary{
  background:#e5e7eb;
  color:#111;
}

.day{font-weight:700;margin-top:14px}

.shiftBox{
  background:#f1f5f9;
  border-radius:14px;
  padding:10px;
  margin:8px 0;
}
.badge{
  display:inline-block;
  background:#14532d;
  color:white;
  padding:6px 10px;
  border-radius:999px;
  font-size:13px;
  margin:4px 4px 0 0;
}
footer{text-align:center;margin-top:16px;font-size:12px;color:#eee}
</style>
</head>

<body>

<div class="container">

  <!-- NHÂN VIÊN -->
  <div class="card">
    <h2>Đăng ký ca làm</h2>
    <div class="sub" id="lockStatus"></div>

    <input id="name" placeholder="Nhập tên nhân viên">

    <div id="form"></div>

    <button onclick="submitShift()">Xác nhận đăng ký</button>
    <button class="secondary" onclick="showManager()">Quản lý</button>
  </div>

  <!-- QUẢN LÝ -->
  <div class="card hidden" id="managerBox">
    <h2>Quản lý ca làm</h2>
    <input id="pin" type="password" placeholder="Nhập mã PIN">
    <button onclick="loginManager()">Đăng nhập</button>

    <div id="summary"></div>
    <button class="secondary" onclick="clearAll()">Xóa toàn bộ đăng ký</button>
  </div>

  <footer>© 2025 An Quy Chế</footer>
</div>

<script>
/* ===== CẤU HÌNH ===== */
const DAYS=["T2","T3","T4","T5","T6","T7","CN"];
const SHIFTS=[
  "C1",
  "C2",
  "C3",
  "F1",
  "F2",
  "2C (C1+C2)",
  "2C (C2+C3)"
];
const ADMIN_PIN="2005";

/* ===== KHÓA THỜI GIAN ===== */
function isLocked(){
  const n=new Date();
  const d=n.getDay(), h=n.getHours();
  return (d===5 && h>=20) || d===6 || d===0;
}
document.getElementById("lockStatus").textContent =
  isLocked()
  ?"⛔ Đã khóa đăng ký • Mở lại Thứ 2"
  :"✅ Đang mở đăng ký • Khóa lúc 20:00 Thứ 6";

/* ===== FORM ===== */
const form=document.getElementById("form");
DAYS.forEach(d=>{
  form.innerHTML+=`
    <div class="day">${d}</div>
    <select id="${d}">
      <option value="">Không đăng ký</option>
      ${SHIFTS.map(s=>`<option>${s}</option>`).join("")}
    </select>
  `;
});

/* ===== NHÂN VIÊN SUBMIT ===== */
function submitShift(){
  if(isLocked()) return alert("Đã khóa đăng ký");
  const name=document.getElementById("name").value.trim();
  if(!name) return alert("Vui lòng nhập tên");

  const shifts={};
  DAYS.forEach(d=>{
    const v=document.getElementById(d).value;
    if(v) shifts[d]=v;
  });
  if(!Object.keys(shifts).length) return alert("Chưa chọn ca");

  const data=JSON.parse(localStorage.getItem("shifts")||"[]");
  data.push({name,shifts,time:Date.now()});
  localStorage.setItem("shifts",JSON.stringify(data));

  alert("Đăng ký thành công");
  document.getElementById("name").value="";
  document.querySelectorAll("select").forEach(s=>s.value="");
}

/* ===== QUẢN LÝ ===== */
function showManager(){
  document.getElementById("managerBox").classList.remove("hidden");
}

function loginManager(){
  if(document.getElementById("pin").value!==ADMIN_PIN)
    return alert("Sai mã PIN");
  renderSummary();
}

/* ===== TỔNG HỢP ===== */
function renderSummary(){
  const data=JSON.parse(localStorage.getItem("shifts")||"[]");
  const sum={};

  data.forEach(e=>{
    Object.entries(e.shifts).forEach(([d,s])=>{
      sum[d]??={};
      sum[d][s]??=[];
      sum[d][s].push(e.name);
    });
  });

  const summary=document.getElementById("summary");
  summary.innerHTML="";
  DAYS.forEach(d=>{
    if(!sum[d]) return;
    summary.innerHTML+=`<div class="day">${d}</div>`;
    SHIFTS.forEach(s=>{
      if(!sum[d][s]) return;
      summary.innerHTML+=`
        <div class="shiftBox">
          <b>${s}</b><br>
          ${sum[d][s].map(n=>`<span class="badge">${n}</span>`).join("")}
        </div>`;
    });
  });
}

/* ===== RESET ===== */
function clearAll(){
  if(confirm("Xóa toàn bộ đăng ký?")){
    localStorage.removeItem("shifts");
    location.reload();
  }
}
</script>
</body>
</html>

